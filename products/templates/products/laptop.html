{% load static %}
<div class="row">
    <div class="col-md-6">
        <!-- Main image of the product -->
        {% with first_image=laptop_spec.product.images.first %}
        {% if first_image %}
        <div class="text-center">
        <img src="{{ first_image.image.url }}" alt="{{ laptop_spec.product.name }}" class="img-fluid big-image mb-3">
        {% else %}
        <img src="{% static 'placeholder_image.jpg' %}" alt="No image available" class="img-fluid big-image mb-3">
        {% endif %}
        {% endwith %}
        </div>

        <!-- The rest images of the products -->
        <div class="row">
            {% for image in laptop_spec.product.images.all %}
            {% if not forloop.first %}
            <div class="col-md-3">
                <img src="{{ image.image.url }}" alt="{{ laptop_spec.product.name }}"
                    class="img-fluid small-image mb-2">
            </div>
            {% endif %}
            {% endfor %}
        </div>
        </div>
        <div class="col-md-6">

            {% for gpu in laptop_spec.gpu.all %}
            <h3>{{ laptop_spec.product.name }} {{ laptop_spec.product.model }} ({{ laptop_spec.cpu.cpu_brand }} /
                {{ laptop_spec.cpu.model }} / {{ gpu.model }} / {{ laptop_spec.memory.capacity }}GB /
                {{ laptop_spec.storage.capacity }} {{ laptop_spec.storage.capacity_type }} /
                {{ laptop_spec.display.display }} inches
                )</h3>
            {% endfor %}
            <h3>{{ laptop_spec.product.year }}</h3>
            <p>Brand: {{ laptop_spec.product.brand }}</p>
            <h1 class="text-danger">${{ laptop_spec.product.price }}</h1>

            <form id="add-to-cart-form" action="{% url 'orders:add_to_cart' slug=laptop_spec.product.slug %}"
                method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label for="quantity">Quantity:</label>
                    <input type="number" id="quantity" name="quantity" value="1" min="1" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Add to Cart</button>
            </form>

            <p id="cart-message"></p>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <h3>Specification</h3>

            <p><strong>CPU:</strong> {{ laptop_spec.cpu.cpu_brand }} {{ laptop_spec.cpu.model }} -
                {{ laptop_spec.cpu.cores}}
                cores - {{ laptop_spec.cpu.threads }} threads - {{ laptop_spec.cpu.cpu_detail }}</p>
            <p><strong>Memory:</strong> {{ laptop_spec.memory.capacity }}GB {{ laptop_spec.memory.type }} -
                {{ laptop_spec.memory.speed }}MHz - {{ laptop_spec.memory.memory_brand.name }}</p>
            <p><strong>Storage:</strong> {{ laptop_spec.storage.capacity }} {{ laptop_spec.storage.capacity_type }} -
                {{ laptop_spec.storage.interface }} - Read Speed: {{ laptop_spec.storage.read_speed }} MB/s - Write
                Speed:
                {{ laptop_spec.storage.write_speed }} MB/s - {{ laptop_spec.storage.form_factor }} - 
                {{ laptop_spec.storage.storage_brand.name }}</p>
            <p><strong>GPU:</strong>
                {% for gpu in laptop_spec.gpu.all %}
                {{ gpu.gpu_brand.name }} {{ gpu.model }} - {{ gpu.vram }} GB VRAM - {{ gpu.vram_type }}<br>
                {% empty %}
                No GPU details available<br>
                {% endfor %}
            </p>
            <p><strong>Display:</strong> {{ laptop_spec.display.display }} inches -
                {{ laptop_spec.display.display_detail }}
            </p>
            <p><strong>Ports:</strong>
                {% for port in laptop_spec.port.all %}
                {{ port.port }}<br>
                {% empty %}
                No port details available<br>
                {% endfor %}
            </p>
            <p><strong>Wireless Connectivity:</strong>
                {% for wireless in laptop_spec.wireless_connectivity.all %}
                {{ wireless.wireless_connectivity }} <br>
                {% empty %}
                No wireless connectivity details available<br>
                {% endfor %}
            </p>
            <p><strong>Webcam:</strong> {{ laptop_spec.webcam.webcam }} </p>
            <p><strong>Battery:</strong> {{ laptop_spec.battery.battery }} Kw</p>
            <p><strong>Operating System:</strong> {{ laptop_spec.operating_system.operating_system }} </p>
            <p><strong>Weight:</strong> {{ laptop_spec.weight }} kg</p>
        </div>
        <div class="col-md-6">
            <h4 class="card-title">Recommended Products</h4>

            {% if recommended_products %}
            {% for recommended_product in recommended_products %}
            <div class="card mb-3 recommend-product">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            {% if recommended_product.product.images.all %}
                            {% with recommended_product.product.images.first as first_image %}
                            <img class="card-img-top" src="{{ first_image.image.url }}"
                                alt="{{ recommended_product.product.name }}">
                            {% endwith %}
                            {% else %}
                            <img class="card-img-top" src="{% static 'placeholder_image.jpg' %}" alt="No image">
                            {% endif %}
                        </div>
                        <div class="col-md-8">
                            <h5 class="card-title">{{ recommended_product.product.name }}
                                {{ laptop_spec.cpu.cpu_brand }} 
                                {{ laptop_spec.cpu.model }} / {{ laptop_spec.gpu.first.gpu_brand }} 
                                {{ laptop_spec.gpu.first.model }} / {{ laptop_spec.storage.capacity }}  
                                {{ laptop_spec.storage.capacity_type }} / {{ laptop_spec.memory.capacity }}GB</h5>
                            <p class="card-text">{{ recommended_product.description }}</p>
                            <p class="card-text">
                                <strong>Price:</strong> ${{ recommended_product.product.price }}
                            </p>
                            <a href="{% url 'products:product_detail' recommended_product.slug %}"
                                class="btn btn-primary">See More</a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="card-text">No recommended products available.</p>
            {% endif %}
        </div>


    </div>

</div>